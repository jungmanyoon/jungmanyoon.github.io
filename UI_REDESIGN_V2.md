# UI 재설계 V2 - 제법 변환 기능 포함

## 분석 결과

### 엑셀 레시피계산기의 핵심 기능

사용자의 엑셀 파일은 단순 배수 변환이 아닌 **제법 변환**이 핵심:

1. **3단 레시피 분리**
   - 원래 레시피 (기준)
   - 사전반죽 (폴리쉬/르방/중종 등에서 분리)
   - 본반죽 (원래 - 사전반죽)

2. **사전반죽 비율 설정**
   | 제법 | 밀가루 비율 | 수분 비율 |
   |------|------------|----------|
   | 폴리쉬 | 60% | 70% |
   | 비가 | 50% | 30% |
   | 중종법 | 50% | 100% |

3. **상단 설정 패널**
   - 팬종류 (대분류/소분류/수량/중량)
   - 비용적 (제품종류별 비용적 값)
   - 오븐 설정 (종류/온도/시간)
   - 사전반죽 설정 (제법 선택/비율)

---

## 개선된 UI 설계

### 새로운 레이아웃 (4단 구조)

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [상단 설정 바]                                                           │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐ │
│ │ 🍞 레시피    │ │ 🍳 팬 설정   │ │ 🔥 오븐     │ │ 🥖 제법/사전반죽    │ │
│ │ [선택 ▼]    │ │ [선택 ▼]    │ │ [선택 ▼]   │ │ [스트레이트 ▼]     │ │
│ │ 배수: ×1.5  │ │ 수량: 3     │ │ 180°C      │ │ □ 사전반죽 사용    │ │
│ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│ ┌───────────────────┐ ┌───────────────────┐ ┌───────────────────────┐  │
│ │ 📋 원래 레시피     │ │ 🥖 사전반죽        │ │ 🍞 본반죽            │  │
│ │                   │ │ (제법 선택시 표시) │ │                      │  │
│ │ 분류│재료│비율│g  │ │ 분류│재료│비율│g  │ │ 분류│재료│비율│g│차이│  │
│ │ ───────────────  │ │ ───────────────   │ │ ────────────────────  │  │
│ │ 밀가루│강력│100│500│ │ 밀가루│강력│50│250│ │ 밀가루│강력│50│250│   │  │
│ │ 수분│물│70│350    │ │ 수분│물│100│350  │ │ 수분│물│0│0│-350    │  │
│ │ 기타│소금│2│10    │ │                   │ │ 기타│소금│2│10│      │  │
│ │ ───────────────  │ │ ───────────────   │ │ ────────────────────  │  │
│ │ 합계: 970g       │ │ 합계: 600g        │ │ 합계: 370g           │  │
│ └───────────────────┘ └───────────────────┘ └───────────────────────┘  │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│ [하단 요약]                                                              │
│ 원래 총량: 970g → 사전반죽: 600g + 본반죽: 370g                          │
│ 수화율: 70% | 손실률: 108% | 예상 완성량: 1,047g                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 핵심 기능 구현 계획

### 1. 제법 변환 로직

```typescript
// 사전반죽 비율
const PREFERMENT_RATIOS = {
  poolish: { flour: 0.6, water: 0.7, yeast: 0.002 },
  biga: { flour: 0.5, water: 0.3, yeast: 0.001 },
  sponge: { flour: 0.5, water: 1.0, yeast: 0.01 },  // 중종법
  levain: { flour: 0.2, water: 0.2 },  // 르방
};

// 레시피 분리 함수
function splitRecipe(recipe, method, ratios) {
  const flourTotal = getFlourTotal(recipe);
  const waterTotal = getWaterTotal(recipe);

  // 사전반죽
  const preferment = {
    flour: flourTotal * ratios.flour,
    water: waterTotal * ratios.water,
    yeast: flourTotal * (ratios.yeast || 0),
  };

  // 본반죽 = 원래 - 사전반죽
  const mainDough = {
    flour: flourTotal - preferment.flour,
    water: waterTotal - preferment.water,
    // 나머지 재료는 그대로
  };

  return { preferment, mainDough };
}
```

### 2. 3단 테이블 컴포넌트

```tsx
// TriplePanelDashboard.tsx
<div className="grid grid-cols-3 gap-4">
  {/* 원래 레시피 */}
  <RecipePanel
    title="원래 레시피"
    recipe={sourceRecipe}
    editable={true}
  />

  {/* 사전반죽 (제법 선택시만 표시) */}
  {usePreferment && (
    <RecipePanel
      title="사전반죽"
      recipe={prefermentRecipe}
      highlight="yellow"
    />
  )}

  {/* 본반죽 */}
  <RecipePanel
    title="본반죽"
    recipe={mainDoughRecipe}
    showDiff={true}
    highlight="blue"
  />
</div>
```

### 3. 상단 설정 패널

```tsx
<SettingsBar>
  {/* 레시피 & 배수 */}
  <RecipeSelector />
  <MultiplierControl />

  {/* 팬 설정 */}
  <PanSelector
    categories={['사각팬', '원형팬', '쉬폰팬']}
    onSelect={handlePanChange}
  />
  <PanQuantityInput />

  {/* 오븐 설정 */}
  <OvenSelector types={['컨벡션', '데크', '에어프라이어']} />
  <TemperatureInput />

  {/* 제법 설정 (핵심!) */}
  <MethodSelector
    methods={['스트레이트', '중종법', '폴리쉬', '비가', '르방']}
    onSelect={handleMethodChange}
  />
  <PrefermentToggle />
  <PrefermentRatioDisplay />
</SettingsBar>
```

---

## 기존 SimpleDashboard와의 차이점

| 항목 | SimpleDashboard (현재) | TriplePanelDashboard (개선) |
|------|----------------------|---------------------------|
| 레시피 표시 | 2단 (원본/변환) | 3단 (원본/사전반죽/본반죽) |
| 변환 방식 | 배수만 적용 | 배수 + 제법 변환 |
| 사전반죽 | 미지원 | 완전 지원 |
| 팬 설정 | 참조만 가능 | 직접 적용 |
| 오븐 설정 | 없음 | 온도/시간 설정 |
| 손실률 | 없음 | 자동 계산 |

---

## 구현 우선순위

### Phase 1: 핵심 기능
1. [x] 기본 3단 레이아웃
2. [ ] 제법 선택 UI
3. [ ] 사전반죽 분리 로직
4. [ ] 본반죽 자동 계산

### Phase 2: 설정 패널
5. [ ] 팬 설정 및 적용
6. [ ] 오븐 설정
7. [ ] 손실률 계산

### Phase 3: 고급 기능
8. [ ] 재료 직접 편집
9. [ ] 레시피 저장/불러오기
10. [ ] 엑셀 내보내기

---

## 적용 기술/패턴

| 단계 | 작업 | 적용 요소 |
|------|------|-----------|
| 1 | 엑셀 분석 | `xlsx skill` + `--persona-analyzer` |
| 2 | 설계 문서 | `--persona-architect` |
| 3 | UI 구현 | `--persona-frontend` |
| 4 | 로직 구현 | `--persona-backend` |
| 5 | 테스트 | `--persona-qa` |
